
<VirtualHost *:443>
DBDriver mysql
DBDParams "dbname=roprotokol user=apache pass=XXX"

ServerName styrmandsinstruktion.danskestudentersroklub.dk

	ServerAdmin webmaster@localhost
	DocumentRoot /data/roprotokol/rowingapp

	RewriteEngine on
	RewriteRule "^/$" "/frontend/cox/cox.html" [L,R=permanent]
# Angular html5 routing
        RewriteRule "^/frontend/cox/[a-z]+/$" "/frontend/cox/cox.html" [L,R=permanent]



        Alias /public /data/roprotokol/public
        
        <Directory "/data/roprotokol/public">
          Options All
          AllowOverride All
          <RequireAny>
            Require all granted
          </RequireAny>
	</Directory>


	<Directory "/data/roprotokol/rowingapp/backend/">
            AllowOverride ALL
            Require valid-user
	</Directory>

	  <Directory "/data/roprotokol/rowingapp/backend/cox/aspirants">
	    Options All
	    AllowOverride All
	    AuthType Basic
	    AuthName "DSR styrmandsinstruktion, log ind med medlemsnummer"
#	    AuthUserFile "/data/konfig/roprotokolpw"
            Require valid-user
            AuthBasicProvider dbd
	    AuthDBDUserPWQuery "SELECT authentication.password FROM roprotokol.authentication, roprotokol.Member WHERE Member.MemberId=%s AND roprotokol.authentication.member_id = Member.id"
	</Directory>

      <Files "datastatus.php">
	  Options All	
	  AllowOverride ALL
          Require all granted
      </Files>


         <FilesMatch "rowers.php|memberrighttypes.php">
		    Options All
	    AuthType Basic
	    AuthName "DSR styrmandsinstruktion, log ind med medlemsnummer"
	    AuthUserFile "/data/konfig/roprotokolpw"
            Require valid-user
            AuthBasicProvider dbd
	    AuthDBDUserPWQuery "SELECT authentication.password FROM roprotokol.authentication, roprotokol.Member WHERE Member.MemberId=%s AND roprotokol.authentication.member_id = Member.id"
	</FilesMatch>
      
	ErrorLog ${APACHE_LOG_DIR}/coxs_error.log
	CustomLog ${APACHE_LOG_DIR}/coxs_access.log combined

	SSLCertificateFile /etc/letsencrypt/live/styrmandsinstruktion.danskestudentersroklub.dk/fullchain.pem
	SSLCertificateKeyFile /etc/letsencrypt/live/styrmandsinstruktion.danskestudentersroklub.dk/privkey.pem
	Include /etc/letsencrypt/options-ssl-apache.conf

</VirtualHost>

